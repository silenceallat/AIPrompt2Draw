spring:
  application:
    name: aiprompt2draw-backend

  profiles:
    active: dev

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/aiprompt2draw?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true}
    username: ${SPRING_DATASOURCE_USERNAME:root}
    password: ${SPRING_DATASOURCE_PASSWORD:root123}
    hikari:
      minimum-idle: 10
      maximum-pool-size: 50
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      pool-name: AIPrompt2DrawHikariCP

  data:
    redis:
      host: ${SPRING_REDIS_HOST:localhost}
      port: ${SPRING_REDIS_PORT:6379}
      database: 0
      timeout: 3000ms
      lettuce:
        pool:
          min-idle: 5
          max-idle: 10
          max-active: 20
          max-wait: 3000ms

  jackson:
    time-zone: Asia/Shanghai
    date-format: yyyy-MM-dd HH:mm:ss
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false

# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
  mapper-locations: classpath*:/mapper/**/*.xml

# Redisson配置
redisson:
  config: |
    singleServerConfig:
      address: "redis://${SPRING_REDIS_HOST:localhost}:${SPRING_REDIS_PORT:6379}"
      database: 0
      connectionPoolSize: 50
      connectionMinimumIdleSize: 10

# 服务器配置
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

# Actuator监控端点
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# Knife4j文档配置
knife4j:
  enable: true
  setting:
    language: zh_cn

springdoc:
  api-docs:
    enabled: true
  swagger-ui:
    enabled: true

# 自定义应用配置
app:
  # 加密密钥
  encrypt:
    key: ${ENCRYPT_KEY:AIPrompt2Draw-AES-Key-32Char}

  # CORS配置
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:*}
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS
    allowed-headers: "*"
    allow-credentials: true
    max-age: 3600

  # JWT配置
  admin:
    jwt:
      secret: ${JWT_SECRET:AIPrompt2Draw-JWT-Secret-Key-Must-Be-At-Least-32-Characters-Long}
      expiration: 86400  # 24小时(秒)
      header: Authorization
      token-prefix: "Bearer "

  # 限流配置
  rate-limit:
    ip-max-keys-per-day: 5  # 同一IP每天最多生成的试用Key数量
    ip-max-requests-per-hour: 300  # 同一IP每小时最大请求数

  # AI模型配置
  ai:
    request-timeout: 30000  # AI请求超时时间(毫秒)
    default-model-type: openai  # 默认使用的模型类型

# 日志配置
logging:
  level:
    root: INFO
    com.aiprompt2draw: DEBUG
    com.baomidou.mybatisplus: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  file:
    name: logs/aiprompt2draw-backend.log
    max-size: 10MB
    max-history: 30
