<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AIPrompt2Draw - AIæµç¨‹å›¾ç”Ÿæˆå™¨ï¼Œä½¿ç”¨äººå·¥æ™ºèƒ½æŠ€æœ¯å¿«é€Ÿç”Ÿæˆä¸“ä¸šæµç¨‹å›¾">
    <meta name="keywords" content="AI,æµç¨‹å›¾,å›¾è¡¨ç”Ÿæˆ,äººå·¥æ™ºèƒ½,è‡ªåŠ¨åŒ–ç»˜å›¾">
    <meta name="author" content="AIPrompt2Draw Team">

    <!-- ç½‘ç«™æ ‡é¢˜ -->
    <title>ä¸€è¯­æˆå›¾ - AIæµç¨‹å›¾ç”Ÿæˆå™¨</title>

    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ¨%3C/text%3E%3C/svg%3E">
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/Prompt2Draw-w.png">

    <!-- ä¸»æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/app.css">

    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="assets/images/Prompt2Draw-w.png" as="image">

    <!-- ä¸»é¢˜è‰² meta æ ‡ç­¾ -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">

    <!-- PWA æ”¯æŒ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ä¸€è¯­æˆå›¾">

    <!-- SEO ä¼˜åŒ– -->
    <meta property="og:title" content="ä¸€è¯­æˆå›¾ - AIæµç¨‹å›¾ç”Ÿæˆå™¨">
    <meta property="og:description" content="ä½¿ç”¨AIæŠ€æœ¯å¿«é€Ÿç”Ÿæˆä¸“ä¸šæµç¨‹å›¾ï¼Œæé«˜å·¥ä½œæ•ˆç‡">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">

    <!-- å®‰å…¨ç›¸å…³ -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <!-- æ€§èƒ½ä¼˜åŒ– -->
    <link rel="dns-prefetch" href="//api.example.com">
</head>
<body>
    <!-- åº”ç”¨åŠ è½½ç•Œé¢ -->
    <div id="app-loading" class="app-loading">
        <div class="logo">
            <img src="assets/images/Prompt2Draw-w.png" alt="ä¸€è¯­æˆå›¾" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div style="display: none; width: 120px; height: 120px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                ğŸ¨
            </div>
        </div>
        <h1 class="title">ä¸€è¯­æˆå›¾</h1>
        <p class="subtitle">AIæµç¨‹å›¾ç”Ÿæˆå™¨</p>
        <div class="spinner"></div>
    </div>

    <!-- åº”ç”¨é”™è¯¯ç•Œé¢ -->
    <div id="app-error" class="app-error" style="display: none;">
        <h1>âŒ åº”ç”¨å¯åŠ¨å¤±è´¥</h1>
        <p>å¾ˆæŠ±æ­‰ï¼Œåº”ç”¨å¯åŠ¨æ—¶é‡åˆ°äº†é—®é¢˜ã€‚å¯èƒ½æ˜¯ç½‘ç»œè¿æ¥é—®é¢˜æˆ–æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ã€‚</p>
        <button class="retry-btn" onclick="location.reload()">é‡æ–°åŠ è½½</button>
    </div>

    <!-- ä¸»åº”ç”¨å†…å®¹ -->
    <div id="app-content">
        <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
    </div>

    <style>
        /* åˆå§‹åŠ è½½æ ·å¼ */
        .app-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .app-loading .logo {
            width: 120px;
            height: 120px;
            margin-bottom: 2rem;
            animation: float 3s ease-in-out infinite;
        }

        .app-loading .logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .app-loading .title {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .app-loading .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            margin-bottom: 2rem;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
        }

        .app-loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* é”™è¯¯é¡µé¢æ ·å¼ */
        .app-error {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            text-align: center;
            padding: 2rem;
        }

        .app-error h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ef4444;
        }

        .app-error p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #d1d5db;
            max-width: 500px;
            line-height: 1.6;
        }

        .app-error .retry-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .app-error .retry-btn:hover {
            transform: translateY(-2px);
        }

        /* éšè—ä¸»å†…å®¹ç›´åˆ°åº”ç”¨åŠ è½½å®Œæˆ */
        #app-content {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #app-content.loaded {
            opacity: 1;
        }
    </style>

    <div class="container">
        <div class="left-panel">
            <div class="header">
                <div class="header-left">
                    <h1>
                        <img src="assets/images/Prompt2Draw-w.png" alt="icon" style="height: 32px; width: 32px;">
                        ä¸€è¯­æˆå›¾ (Prompt2Draw)
                    </h1>
                </div>
                <div class="header-actions">
                    <div class="api-status" id="apiStatus">
                        <span class="status-dot"></span>
                        <span>æœªé…ç½®</span>
                    </div>
                    <button class="settings-btn" id="modeToggleBtn" onclick="toggleMode()" title="åˆ‡æ¢æ¨¡å¼">
                        ğŸ”„ å‰ç«¯æ¨¡å¼
                    </button>
                    <button class="settings-btn" onclick="testDrawIO()" title="æµ‹è¯•DrawIO">
                        ğŸ§ª æµ‹è¯•
                    </button>
                    <button class="settings-btn" onclick="openSettings()">
                        âš™ï¸ è®¾ç½®
                    </button>
                    <button class="settings-btn" onclick="openAdminPage()" title="ç®¡ç†åå°" id="adminBtn" style="display: none;">
                        ğŸ› ï¸ ç®¡ç†
                    </button>
                    <button class="settings-btn" onclick="openProfile()" title="ä¸ªäººä¸­å¿ƒ">
                        ğŸ‘¤ ä¸ªäººä¸­å¿ƒ
                    </button>
                    <button class="settings-btn" onclick="logout()" title="é€€å‡ºç™»å½•">
                        ğŸšª é€€å‡º
                    </button>
                     <button class="theme-toggle-btn" id="themeToggleBtn" onclick="uiManager.toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">â˜€ï¸</button>
                </div>
            </div>
            <div class="drawio-container">
                <div id="drawioPlaceholder" class="drawio-placeholder">
                    è¯·åœ¨å³ä¾§è¾“å…¥ä½ çš„éœ€æ±‚ï¼Œè¦åšä»€ä¹ˆï¼Œ<br>å¾—åˆ°ç»“æœåç‚¹å‡»åŠ è½½å³å¯å±•ç¤ºã€‚
                </div>
                <iframe id="drawioFrame" src="https://embed.diagrams.net/?embed=1&proto=json&libraries=1&noSaveBtn=1&saveAndExit=0"></iframe>
            </div>
        </div>

        <div class="right-panel">
            <div class="chat-card">
                <div class="chat-header">
                    <h2>ğŸ’¬ AI æˆå›¾åŠ©æ‰‹</h2>
                    <div class="chat-header-actions" style="display: flex; gap: 8px;">
                        <button class="help-btn" id="newChatBtn" onclick="uiManager.newChat()" title="æ–°å»ºå¯¹è¯">â•</button>
                        <button class="help-btn" onclick="uiManager.openTips()" title="æŸ¥çœ‹å¸®åŠ©">ğŸ’¡</button>
                    </div>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message assistant">
                        <div class="message-content">
                            ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ã€‚æè¿°ä½ æƒ³è¦åˆ›å»ºçš„æµç¨‹å›¾ï¼Œæˆ‘ä¼šå¸®ä½ ç”Ÿæˆï¼
                            <br><br>
                            <strong>ğŸ“Œ ä½¿ç”¨æ­¥éª¤ï¼š</strong>
                            <br>1. ç‚¹å‡»å³ä¸Šè§’ âš™ï¸ é…ç½®APIå¯†é’¥
                            <br>2. æè¿°ä½ æƒ³è¦çš„æµç¨‹å›¾å†…å®¹
                            <br>3. AIç”Ÿæˆåå°†è‡ªåŠ¨åŠ è½½åˆ°å·¦ä¾§
                            <br>4. æˆ–ç‚¹å‡» ğŸ“‹ å¤åˆ¶XMLï¼ˆæ‰‹åŠ¨å¯¼å…¥ï¼‰
                            <br><br>
                            <small>ğŸ’¡ æç¤ºï¼šç‚¹å‡»æˆ‘ä¸Šæ–¹çš„ ğŸ’¡ æŒ‰é’®å¯æŸ¥çœ‹æ›´å¤šå¸®åŠ©å’Œç¤ºä¾‹æ¨¡æ¿ï¼</small>
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <div class="form-group" style="margin-bottom: 2px; padding-bottom: 2px; border-bottom: 1px solid #f0f0f0;">
                        <div class="switch-group">
                            <div>
                                <label style="margin-bottom: 0; font-size: 14px;">æºå¸¦å†å²å¯¹è¯</label>
                                <small style="margin-top: 0px; font-size: 12px; line-height: 1.3;">å…³é—­åå¯èŠ‚çœTokens</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="historyToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="chat-input-wrapper">
                        <textarea
                            id="chatInput"
                            class="chat-input"
                            placeholder="æè¿°ä½ æƒ³è¦çš„æµç¨‹å›¾å†…å®¹..."
                            rows="1"
                        ></textarea>
                        <button class="send-btn" id="sendBtn" onclick="uiManager.handleSendMessage()">
                            å‘é€
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display:none;" onchange="handleFileImport(event)">

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3>âš™ï¸ APIé…ç½®</h3>
                <button class="modal-close" onclick="uiManager.closeSettings()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>API æœåŠ¡å•†</label>
                    <select id="providerSelect" onchange="uiManager.populateProviderUI(true)">
                        <option value="siliconflow">ç¡…åŸºæµåŠ¨ (Siliconflow)</option>
                        <option value="openrouter">OpenRouter</option>
                        <option value="kimi">Kimi (Moonshot)</option>
                        <option value="zhipu">æ™ºè°± GLM (Zhipu)</option>
                        <option value="minimax">MiniMax</option>
                        <option value="modelscope">é­”æ­ (ModelScope)</option>
                        <option value="custom">è‡ªå®šä¹‰</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>API Key *</label>
                    <input type="password" id="apiKeyInput" placeholder="è¯·è¾“å…¥æ‰€é€‰æœåŠ¡å•†çš„ API Key">
                    <small>è¯·ç¡®ä¿ API Key ä¸ä¸Šæ–¹é€‰æ‹©çš„æœåŠ¡å•†åŒ¹é…</small>
                </div>

                <div class="form-group">
                    <label>API åœ°å€</label>
                    <input type="text" id="apiUrlInput" value="https://api.siliconflow.cn/v1/chat/completions" placeholder="APIåœ°å€">
                    <small>é€‰æ‹©æœåŠ¡å•†å¯è‡ªåŠ¨å¡«å……ï¼Œ"è‡ªå®šä¹‰"æ—¶å¯æ‰‹åŠ¨ä¿®æ”¹</small>
                </div>

                <div class="form-group">
                    <label>æ¨¡å‹é€‰æ‹©</label>
                    <select id="modelSelect">
                    </select>
                    <small>é€‰æ‹©é€‚åˆçš„AIæ¨¡å‹ç”Ÿæˆæµç¨‹å›¾</small>
                </div>

                <div class="form-group">
                    <div class="switch-group">
                        <div>
                            <label style="margin-bottom: 0;">æµå¼è¾“å‡º</label>
                            <small style="margin-top: 4px;">å®æ—¶æ˜¾ç¤ºç”Ÿæˆå†…å®¹</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="streamToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="importSettings()" style="margin-right: auto;">å¯¼å…¥é…ç½®</button>
                <button class="btn btn-secondary" onclick="exportSettings()">å¯¼å‡ºé…ç½®</button>
                <button class="btn btn-secondary" onclick="uiManager.closeSettings()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveSettings()">ä¿å­˜é…ç½®</button>
            </div>
        </div>
    </div>

    <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="tipsModal">
        <div class="modal">
            <div class="modal-header">
                <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
                <button class="modal-close" onclick="uiManager.closeTips()">Ã—</button>
            </div>
            <div class="modal-body" style="padding-top: 16px;">
                <ol>
                    <li>ç‚¹å‡»å³ä¸Šè§’ âš™ï¸ è®¾ç½®é…ç½®API</li>
                    <li>è¾“å…¥æµç¨‹å›¾æè¿°ï¼ŒAIå°†ç”ŸæˆXML</li>
                    <li>AIç”Ÿæˆåå°†**è‡ªåŠ¨åŠ è½½**åˆ°å·¦ä¾§ç¼–è¾‘å™¨</li>
                    <li>å¦‚è‡ªåŠ¨åŠ è½½å¤±è´¥ï¼Œå¯ç‚¹å‡»"ğŸ“‹ å¤åˆ¶XML"æ‰‹åŠ¨å¯¼å…¥</li>
                </ol>
                <strong>âœ¨ ç¤ºä¾‹æ¨¡æ¿</strong>
                <div class="example-prompts">
                    <span class="example-prompt" onclick="uiManager.fillExample('åˆ›å»ºä¸€ä¸ªç”µå•†è®¢å•å¤„ç†æµç¨‹å›¾ï¼ŒåŒ…æ‹¬ä¸‹å•ã€æ”¯ä»˜ã€å‘è´§ã€æ”¶è´§ç­‰ç¯èŠ‚')">ğŸ“¦ è®¢å•æµç¨‹</span>
                    <span class="example-prompt" onclick="uiManager.fillExample('ç”Ÿæˆä¸€ä¸ªç”¨æˆ·ç™»å½•éªŒè¯æµç¨‹å›¾')">ğŸ” ç™»å½•æµç¨‹</span>
                    <span class="example-prompt" onclick="uiManager.fillExample('ç”»ä¸€ä¸ªè¯·å‡å®¡æ‰¹æµç¨‹')">ğŸ“ å®¡æ‰¹æµç¨‹</span>
                    <span class="example-prompt" onclick="uiManager.fillExample('è®¾è®¡ä¸€ä¸ªé€€æ¬¾å¤„ç†æµç¨‹')">ğŸ’° é€€æ¬¾æµç¨‹</span>
                </div>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                 <button class="btn btn-primary" id="tipsCloseBtn" onclick="uiManager.closeTips()">æˆ‘æ˜ç™½äº†</button>
            </div>
        </div>
    </div>

    <!-- åº”ç”¨é…ç½® -->
    <script src="config/app-config.js"></script>

    <!-- åŸºç¡€ç»„ä»¶ç±» -->
    <script src="js/components/base/component.js"></script>

    <!-- APIå®¢æˆ·ç«¯ -->
    <script src="js/api.js"></script>

    <!-- è®¤è¯ç®¡ç† -->
    <script src="js/auth.js"></script>

    <!-- è·¯ç”±ç®¡ç† -->
    <script src="js/router.js"></script>

    <!-- ç»„ä»¶æ–‡ä»¶ -->
    <script src="js/components/login.js"></script>
    <script src="js/components/main.js"></script>
    <script src="js/components/profile.js"></script>
    <script src="js/components/admin.js"></script>

    <!-- ä¸»åº”ç”¨å…¥å£ -->
    <script src="js/app.js"></script>

    <!-- åº”ç”¨å¯åŠ¨è„šæœ¬ -->
    <script>
        /**
         * åº”ç”¨å¯åŠ¨å’Œé”™è¯¯å¤„ç†
         */
        (function() {
            'use strict';

            // å¯åŠ¨åº”ç”¨
            async function startApplication() {
                try {
                    console.log('ğŸš€ å¼€å§‹å¯åŠ¨ AIPrompt2Draw åº”ç”¨...');

                    // æ£€æŸ¥å¿…è¦çš„ä¾èµ–
                    if (!window.AppConfig) {
                        throw new Error('åº”ç”¨é…ç½®æœªåŠ è½½');
                    }

                    if (!window.BaseComponent) {
                        throw new Error('åŸºç¡€ç»„ä»¶ç±»æœªåŠ è½½');
                    }

                    if (!window.authManager && !window.AuthManager) {
                        throw new Error('è®¤è¯ç®¡ç†å™¨æœªåŠ è½½');
                    }

                    if (!window.router && !window.Router) {
                        throw new Error('è·¯ç”±ç®¡ç†å™¨æœªåŠ è½½');
                    }

                    if (!window.App) {
                        throw new Error('åº”ç”¨ä¸»ç±»æœªåŠ è½½');
                    }

                    // åˆå§‹åŒ–åº”ç”¨
                    await window.startApp();

                    // éšè—åŠ è½½ç•Œé¢
                    const loadingElement = document.getElementById('app-loading');
                    const contentElement = document.getElementById('app-content');

                    if (loadingElement) {
                        loadingElement.style.opacity = '0';
                        setTimeout(() => {
                            loadingElement.style.display = 'none';
                        }, 300);
                    }

                    if (contentElement) {
                        contentElement.classList.add('loaded');
                    }

                    console.log('âœ… AIPrompt2Draw åº”ç”¨å¯åŠ¨å®Œæˆ');

                } catch (error) {
                    console.error('âŒ åº”ç”¨å¯åŠ¨å¤±è´¥:', error);
                    showStartupError(error);
                }
            }

            // æ˜¾ç¤ºå¯åŠ¨é”™è¯¯
            function showStartupError(error) {
                const loadingElement = document.getElementById('app-loading');
                const errorElement = document.getElementById('app-error');

                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }

                if (errorElement) {
                    errorElement.style.display = 'flex';

                    // åœ¨å¼€å‘ç¯å¢ƒä¸‹æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
                    if (window.AppConfig?.DEBUG?.ENABLED) {
                        const errorDetails = errorElement.querySelector('p');
                        if (errorDetails) {
                            errorDetails.innerHTML = `
                                <strong>é”™è¯¯è¯¦æƒ…:</strong><br>
                                ${error.message}<br><br>
                                <small>è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ›´å¤šä¿¡æ¯</small>
                            `;
                        }
                    }
                }
            }

            // å…¨å±€é”™è¯¯å¤„ç†
            window.addEventListener('error', function(event) {
                console.error('å…¨å±€é”™è¯¯:', event.error);
                if (!document.getElementById('app-content').classList.contains('loaded')) {
                    showStartupError(event.error);
                }
            });

            window.addEventListener('unhandledrejection', function(event) {
                console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);
                event.preventDefault();
            });

            // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden && window.app) {
                    // é¡µé¢é‡æ–°å¯è§æ—¶æ£€æŸ¥åº”ç”¨çŠ¶æ€
                    console.log('ğŸ‘ï¸ é¡µé¢é‡æ–°å¯è§ï¼Œæ£€æŸ¥åº”ç”¨çŠ¶æ€...');
                }
            });

            // ç½‘ç»œçŠ¶æ€ç›‘å¬
            window.addEventListener('online', function() {
                console.log('ğŸŒ ç½‘ç»œè¿æ¥å·²æ¢å¤');
                if (window.app) {
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç½‘ç»œæ¢å¤åçš„å¤„ç†é€»è¾‘
                }
            });

            window.addEventListener('offline', function() {
                console.log('ğŸ“¡ ç½‘ç»œè¿æ¥å·²æ–­å¼€');
                if (window.app) {
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç½‘ç»œæ–­å¼€åçš„å¤„ç†é€»è¾‘
                }
            });

            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(event) {
                // Ctrl/Cmd + K æ‰“å¼€æœç´¢
                if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                    event.preventDefault();
                    const searchInput = document.querySelector('#searchInput');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }

                // Escape å…³é—­æ¨¡æ€æ¡†æˆ–ä¸‹æ‹‰èœå•
                if (event.key === 'Escape') {
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ESCé”®çš„å¤„ç†é€»è¾‘
                }
            });

            // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
            function checkBrowserCompatibility() {
                const requiredFeatures = [
                    'Promise',
                    'fetch',
                    'localStorage',
                    'sessionStorage',
                    'CustomEvent',
                    'Map',
                    'Set'
                ];

                const missingFeatures = requiredFeatures.filter(feature =>
                    typeof window[feature] === 'undefined'
                );

                if (missingFeatures.length > 0) {
                    showStartupError(new Error(`æµè§ˆå™¨ä¸å…¼å®¹ï¼Œç¼ºå°‘ä»¥ä¸‹åŠŸèƒ½: ${missingFeatures.join(', ')}`));
                    return false;
                }

                return true;
            }

            // åˆå§‹åŒ–åº”ç”¨
            function initializeApp() {
                console.log('ğŸ”§ æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§...');

                if (!checkBrowserCompatibility()) {
                    return;
                }

                console.log('ğŸ”§ å¼€å§‹åŠ è½½åº”ç”¨èµ„æº...');

                // ç¡®ä¿æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆåå†å¯åŠ¨åº”ç”¨
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', startApplication);
                } else {
                    // DOMå·²ç»åŠ è½½å®Œæˆï¼Œç›´æ¥å¯åŠ¨åº”ç”¨
                    startApplication();
                }
            }

            // å¯åŠ¨åº”ç”¨
            initializeApp();

            // æ€§èƒ½ç›‘æ§ï¼ˆä»…åœ¨å¼€å‘ç¯å¢ƒï¼‰
            if (window.AppConfig?.DEBUG?.ENABLED) {
                // ç›‘æ§é¡µé¢åŠ è½½æ€§èƒ½
                window.addEventListener('load', function() {
                    setTimeout(function() {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        if (perfData) {
                            console.log('ğŸ“Š é¡µé¢åŠ è½½æ€§èƒ½:', {
                                loadTime: Math.round(perfData.loadEventEnd - perfData.loadEventStart),
                                domReady: Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart),
                                firstPaint: performance.getEntriesByType('paint')[0]?.startTime,
                                firstContentfulPaint: performance.getEntriesByType('paint')[1]?.startTime
                            });
                        }
                    }, 0);
                });
            }

        })();
    </script>

    <!-- Service Worker æ³¨å†Œï¼ˆPWAæ”¯æŒï¼‰ -->
    <script>
        // æ³¨å†Œ Service Workerï¼ˆå¦‚æœéœ€è¦PWAåŠŸèƒ½ï¼‰
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('âœ… ServiceWorker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('âŒ ServiceWorker æ³¨å†Œå¤±è´¥:', error);
                    });
            });
        }
    </script>

    <!-- åˆ†æä»£ç ï¼ˆå¦‚æœéœ€è¦ï¼‰ -->
    <!--
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
    -->
</body>
</html>